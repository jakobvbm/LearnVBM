<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>📚 Lern-App (Quest Edition)</title>
    <meta name="theme-color" content="#667eea">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="user-header" id="user-header" style="display:none">
        <div class="user-info">
            <span>👋 <span id="current-username">Spieler</span></span>
            <div class="points-display">🏆 <span id="user-points">0</span> Punkte</div>
            <div class="club-display" id="club-info">🏛️ <span id="user-club">Kein Club</span></div>
            <div class="admin-badge" id="admin-badge" style="display:none">👑 Admin</div>
            <div class="quest-notification" id="quest-notification" style="display:none" onclick="showQuestModal()">
                📋 <span id="pending-quests">0</span> Quests
            </div>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
            <button class="action-button info-btn" onclick="showSettingsScreen()">⚙️</button>
            <button class="logout-btn" onclick="logout()">Abmelden</button>
        </div>
    </div>

    <div class="container">
        <div id="login-screen" class="login-screen">
            <div class="card">
                <h1 style="text-align:center;font-size:2rem;margin-bottom:8px">📚 Lern-App</h1>
                <div class="login-form">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('login', event)">🔓 Anmelden</button>
                        <button class="tab-button" onclick="switchTab('register', event)">📝 Registrieren</button>
                    </div>

                    <div id="login-form">
                        <div class="form-group">
                            <label class="form-label">👤 Benutzername</label>
                            <input id="login-username" class="form-input" placeholder="Dein Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">🔒 Passwort</label>
                            <input id="login-password" type="password" class="form-input" placeholder="Dein Passwort">
                        </div>
                        <div style="display:flex;gap:8px;justify-content:center">
                            <button class="action-button check-btn" onclick="login()">🚀 Anmelden</button>
                        </div>
                    </div>

                    <div id="register-form" style="display:none">
                        <div class="form-group">
                            <label class="form-label">👤 Benutzername wählen</label>
                            <input id="register-username" class="form-input" placeholder="Wähle einen Namen">
                        </div>
                        <div class="form-group">
                            <label class="form-label">✉️ E-Mail-Adresse</label>
                            <input id="register-email" type="email" class="form-input" placeholder="Deine E-Mail-Adresse">
                        </div>
                        <div class="form-group">
                            <label class="form-label">🔒 Passwort</label>
                            <input id="register-password" type="password" class="form-input" placeholder="Wähle ein Passwort">
                        </div>
                        <div class="form-group">
                            <label class="form-label">🔒 Passwort bestätigen</label>
                            <input id="register-password-confirm" type="password" class="form-input" placeholder="Passwort wiederholen">
                        </div>
                        <div style="display:flex;gap:8px;justify-content:center">
                            <button class="action-button check-btn" onclick="register()">✨ Account erstellen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="main-screen" style="display:none">
            <div class="card">
                <div class="nav-tabs">
                    <div class="nav-tab active" onclick="showTab('modes', event)">🎮 Lernen</div>
                    <div class="nav-tab" onclick="showTab('clubs', event)">🏛️ Clubs</div>
                    <div class="nav-tab" onclick="showTab('quests', event)">
                        📋 Quests
                        <div class="quest-badge" id="quest-tab-badge" style="display:none">0</div>
                    </div>
                    <div class="nav-tab" onclick="showTab('leaderboard', event)">🏆 Bestenliste</div>
                </div>

                <div id="modes-tab" class="tab-content">
                    <div class="modes-grid">
                        <div class="mode-card">
                            <h3>🧮 Mathematik</h3>
                            <p>Mathe-Modus (lokal)</p>
                            <div style="margin-top:8px">
                                <button class="action-button check-btn" onclick="showMathMode()">Start</button>
                            </div>
                        </div>
                        <div class="mode-card">
                            <h3>📝 Deutsch</h3>
                            <p>Sprach-Übungen</p>
                            <div style="margin-top:8px">
                                <button class="action-button check-btn" onclick="showGermanMode()">Start</button>
                            </div>
                        </div>
                        <div class="mode-card">
                            <h3>🇬🇧 English</h3>
                            <p>Englisch lernen</p>
                            <div style="margin-top:8px">
                                <button class="action-button check-btn" onclick="showEnglishMode()">Start</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="clubs-tab" class="tab-content" style="display:none">
                    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:12px">
                        <button class="action-button check-btn" onclick="showCreateClubModal()">➕ Club erstellen</button>
                        <button class="action-button back-btn" onclick="showJoinClubModal()">🚪 Club beitreten</button>
                    </div>

                    <div id="current-club-info" style="display:none">
                        <div class="admin-panel" id="admin-panel" style="display:none">
                            <h3>👑 Admin-Bereich</h3>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                                <button class="action-button warning-btn" onclick="showCreateQuestModal()">📋 Quest erstellen</button>
                                <button class="action-button info-btn" onclick="showManageAdminsModal()">👥 Admins verwalten</button>
                                <button class="action-button info-btn" onclick="showQuestProgressModal()">📊 Quest-Fortschritt</button>
                            </div>
                        </div>
                        
                        <div class="leaderboard">
                            <h3>🏛️ Dein Club: <span id="current-club-name"></span></h3>
                            <div style="text-align:center;margin:8px 0">Club-Code: <strong id="current-club-code">-</strong></div>
                            <div style="text-align:center;margin-bottom:8px"><button class="action-button back-btn" onclick="leaveClub()">🚪 Club verlassen</button></div>
                            <h4>👥 Mitglieder</h4>
                            <ul id="club-members-list" style="list-style:none;padding:0"></ul>
                        </div>
                    </div>
                </div>

                <div id="quests-tab" class="tab-content" style="display:none">
                    <div id="quest-list">
                        <h3>📋 Deine Quests</h3>
                        <div id="active-quests"></div>
                        <div id="completed-quests" style="margin-top:20px">
                            <h4>✅ Abgeschlossen</h4>
                            <div id="completed-quests-list"></div>
                        </div>
                    </div>
                </div>

                <div id="leaderboard-tab" class="tab-content" style="display:none">
                    <div class="leaderboard">
                        <h3>🏆 Globale Bestenliste</h3>
                        <div style="text-align:center;margin:8px 0"><button class="action-button check-btn" onclick="refreshLeaderboard()">🔄 Aktualisieren</button></div>
                        <ul id="global-leaderboard" style="list-style:none;padding:0"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="math-screen" style="display:none">
            <div class="card">
                <h3 id="math-mode-title">🧮 Mathe Trainer</h3>
                <div style="margin:12px 0">
                    <div id="question" style="font-size:1.2rem;font-weight:700">Bereit zum Rechnen!</div>
                    <input id="answer" class="form-input" style="margin-top:8px;width:120px" placeholder="?" />
                </div>
                <div style="display:flex;gap:8px"><button class="action-button check-btn" onclick="checkAnswer()">✅ Prüfen</button><button class="action-button back-btn" onclick="goBack()">🏠 Zurück</button></div>
                <div style="margin-top:12px">
                    <div id="quest-progress-display" style="display:none">
                        <div>Quest-Fortschritt: <span id="quest-current">0</span>/<span id="quest-total">0</span></div>
                        <div class="quest-progress"><div class="quest-progress-fill" id="quest-progress-bar"></div></div>
                    </div>
                    <div>Richtig: <span id="correct-score">0</span> — Falsch: <span id="wrong-score">0</span></div>
                </div>
            </div>
        </div>

        <!-- Quest Modal -->
        <div class="modal" id="quest-modal">
            <div class="modal-content">
                <h3>📋 Deine aktiven Quests</h3>
                <div id="quest-modal-content"></div>
                <div style="text-align:center;margin-top:15px">
                    <button class="action-button back-btn" onclick="closeModal('quest-modal')">Schließen</button>
                </div>
            </div>
        </div>

        <!-- Create Quest Modal -->
        <div class="modal" id="create-quest-modal">
            <div class="modal-content">
                <h3>📋 Neue Quest erstellen</h3>
                
                <div class="subject-tabs">
                    <button class="subject-tab active" onclick="selectQuestSubject('math', event)">🧮 Mathe</button>
                    <button class="subject-tab" onclick="selectQuestSubject('german', event)">📝 Deutsch</button>
                    <button class="subject-tab" onclick="selectQuestSubject('english', event)">🇬🇧 English</button>
                </div>

                <div class="form-group">
                    <label class="form-label">📝 Quest-Titel</label>
                    <input id="quest-title" class="form-input" placeholder="z.B. Grundrechenarten üben">
                </div>

                <div class="form-group">
                    <label class="form-label">🎯 Anzahl Aufgaben</label>
                    <input id="quest-count" type="number" class="form-input" value="10" min="1" max="50">
                </div>

                <div class="form-group">
                    <label class="form-label">⚡ Schwierigkeit</label>
                    <div class="difficulty-selector">
                        <div class="difficulty-btn selected" onclick="selectDifficulty('easy', event)">😊 Leicht</div>
                        <div class="difficulty-btn" onclick="selectDifficulty('medium', event)">🤔 Mittel</div>
                        <div class="difficulty-btn" onclick="selectDifficulty('hard', event)">😅 Schwer</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">👥 Für wen?</label>
                    <select id="quest-target" class="form-select">
                        <option value="all">Alle Club-Mitglieder</option>
                        <option value="specific">Bestimmte Mitglieder</option>
                    </select>
                </div>

                <div id="member-selection" style="display:none">
                    <div id="member-checkboxes"></div>
                </div>

                <div style="display:flex;gap:8px;justify-content:center;margin-top:15px">
                    <button class="action-button check-btn" onclick="createQuest()">🚀 Quest erstellen</button>
                    <button class="action-button back-btn" onclick="closeModal('create-quest-modal')">❌ Abbrechen</button>
                </div>
            </div>
        </div>

        <!-- Manage Admins Modal -->
        <div class="modal" id="manage-admins-modal">
            <div class="modal-content">
                <h3>👑 Admins verwalten</h3>
                <div id="admin-management-list"></div>
                <div style="text-align:center;margin-top:15px">
                    <button class="action-button back-btn" onclick="closeModal('manage-admins-modal')">Schließen</button>
                </div>
            </div>
        </div>

        <!-- Quest Progress Modal -->
        <div class.modal" id="quest-progress-modal">
            <div class="modal-content">
                <h3>📊 Quest-Fortschritt</h3>
                <div id="quest-progress-list"></div>
                <div style="text-align:center;margin-top:15px">
                    <button class="action-button back-btn" onclick="closeModal('quest-progress-modal')">Schließen</button>
                </div>
            </div>
        </div>

        <!-- Other existing modals -->
        <div class="modal" id="create-club-modal">
            <div class="modal-content">
                <h3>➕ Club erstellen</h3>
                <div class="form-group">
                    <label>🏛️ Club-Name</label>
                    <input id="new-club-name" class="form-input" placeholder="Wähle einen Namen">
                </div>
                <div class="form-group">
                    <label>🔒 Club-Code (optional)</label>
                    <input id="new-club-code" class="form-input" placeholder="Code (leer = Server generiert)">
                </div>
                <div style="display:flex;gap:8px;justify-content:center">
                    <button class="action-button check-btn" onclick="createClub()">🚀 Club gründen</button>
                    <button class="action-button back-btn" onclick="closeModal('create-club-modal')">❌ Abbrechen</button>
                </div>
            </div>
        </div>

        <div class="modal" id="join-club-modal">
            <div class="modal-content">
                <h3>🚪 Club beitreten</h3>
                <div class="form-group">
                    <label>🔍 Club-Code eingeben</label>
                    <input id="join-club-input" class="form-input" placeholder="6-stelliger Club-Code" oninput="searchClubs()">
                </div>
                <div id="available-clubs-list" style="max-height:200px;overflow:auto;margin-bottom:8px"></div>
                <div id="no-clubs-message" style="color:#7f8c8d;text-align:center;margin-bottom:8px">Gib einen Club-Code ein um beizutreten</div>
                <div style="display:flex;gap:8px;justify-content:center">
                    <button id="join-club-btn" class="action-button check-btn" onclick="joinSelectedClub()" disabled>🤝 Beitreten</button>
                    <button class="action-button back-btn" onclick="closeModal('join-club-modal')">❌ Abbrechen</button>
                </div>
            </div>
        </div>

        <div id="settings-screen" style="display:none">
            <div class="card">
                <h2>⚙️ Einstellungen</h2>
                <div class="form-group">
                    <label class="form-label">👤 Name ändern</label>
                    <input id="settings-username" class="form-input" placeholder="Neuer Name">
                    <button class="action-button info-btn" onclick="changeUsername()">Speichern</button>
                </div>
                <div class="form-group">
                    <label class="form-label">🔒 Passwort ändern</label>
                    <input id="settings-password" type="password" class="form-input" placeholder="Neues Passwort">
                    <button class="action-button info-btn" onclick="changePassword()">Speichern</button>
                </div>
                <div class="form-group">
                    <label class="form-label">🌗 Dark/Light Mode</label>
                    <label class="switch">
                        <input type="checkbox" id="mode-toggle" onchange="toggleMode()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">🔊 Lautstärke</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="50" style="width:100%">
                </div>
                <div class="form-group">
                    <label class="form-label">🌐 Sprache</label>
                    <select id="language-select" class="form-select">
                        <option value="de">Deutsch</option>
                        <option value="en">Englisch</option>
                        <option value="fr">Französisch</option>
                        <option value="es">Spanisch</option>
                    </select>
                </div>
                <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:24px">
                    <button class="action-button back-btn" onclick="cancelSettings()">Abbrechen</button>
                    <button class="action-button check-btn" onclick="saveSettings()">Speichern</button>
                </div>
            </div>
        </div>
    </div>

<script src="script.js"></script>
</body>
</html>